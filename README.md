# Процессы. 

Процессом называется выполняемая в данный момент программа или ее потомки. 

Каждый процесс имеет имя и уникальный номер – идентификационный номер процесса (Process IDentificator - PID). Именно PID используется ядром операционной системы и утилитами для управления процессами.

## 1. Для чего предназначена команда at? Как её использовать?

Команда at позволяет передавать задания демону cron для одноразового выполнения в назначенное время. Выдавая задание, команда at сохраняет в отдельном файле как его текст, так и все текущие переменные среды, чего не делает 
команда crontab. 
По умолчанию все результаты выполнения задания направляются пользователю в виде электронного сообщения.

Пользователям разрешается использовать команду at, если их регистрационные имена указаны в файле /etc/at.allow. Если этот файл не существует, проверяется файл /etc/at.deny, чтобы определить, не запрещен ли пользователю доступ к at.

Базовый формат команды at:

at [-f файл] [-l –d -m] время

– f файл – список заданий должен быть взят из указанного файла;

– l – вывод на экран списка заданий; аналог команды atq;

– d – удаление задания с указанным номером; аналог команды atrm (в некоторых системах заменяется опцией -r);

– m – выдача пользователю сообщения по электронной почте о завершении задания;

Время – определение времени выполнения задания. Допускается указание не только времени в формате часы:минуты, но и даты, а также многочисленных ключевых слов, таких как названия дней недели, месяцев, слов today (сегодня), tomorrow (завтра), now (сейчас) и др. Часто удобна запись вида now+3 hours (через 3 часа). 

Примеры корректного указания времени при вызове команды at:

at now+1 hour – через час;

at 9am tomorrow – завтра в 9:00 утра;

at 15:00 May 24 – 24 мая в 15:00;

Если необходимо с помощью команды at запустить файл сценария, то его имя необходимо указать после опции –f, например: 

at 3:00pm tomorrow –f /apps/bin/db_table.sh 

## 2. Для чего предназначена команда batch? Как её использовать? Чем отличаются команды at и batch?

В отличие от at, batch позволяет операционной системе самой решить, когда наступает подходящий момент для запуска задачи в то время, когда система наименее загружена.

Формат команды batch представляет собой список команд для выполнения, следующих в строках за командой. Заканчивается список нажатием комбинации клавиш Ctrl+D 
Можно поместить список команд в файл и перенаправить его на стандартный ввод команды batch

Следующую команду можно вводить с терминала:
batch
sort <file> outfile
<EOT>

Строка <EOT> появляется после нажатия клавиш Ctrl+D 

batch или его псевдоним at -b планирует задания и выполняет их в пакетной очереди, если позволяет уровень загрузки системы. По умолчанию задания выполняются, когда средняя загрузка системы ниже 1,5. Значение нагрузки можно указать при вызове демона atd . Если средняя загрузка системы выше указанной, задания будут ждать в очереди.

Чтобы создать batch задание, нужно передать команды, которые хотите выполнить: echo "command_to_be_run" | batch

## 3. Для чего предназначен демон cron? 4. Как использовать команду crontab?

Команда cron (/usr/sbin/cron) запускает процесс, выполняющий команды в указанные дни и время. 

Регулярно выполняемые команды задаются инструкциями в файлах crontab в каталоге /var/spool/cron/crontabs. Пользователи могут задавать собственные файлы crontab с помощью команды crontab.

Примеры команд, запускаемых cron

01 * * * * /usr/bin/script – команда /usr/bin/script запускается в первую минуту каждого часа;

20 8 * * * /usr/bin/script - команда /usr/bin/script запускается каждый день в 8 часов 20 минут;

00 6 * * 0 /usr/bin/script - команда /usr/bin/script запускается в 6 часов каждое воскресенье;

40 7 1 * * /usr/bin/script - команда /usr/bin/script запускается в 7 часов 40 минут каждое первое число месяца. 

crontab - поддержка файлов crontab для отдельных пользователей. Используется для добавления, удаления или выведения списка таблиц, используемых для управления демоном cron. 
Каждый пользователь может иметь свои собственные файлы crontab, и, хотя эти файлы доступны в /var/cron/tabs они не предназначены для редактирования напрямую. Если файл /var/cron/cron.allow существует, пользователь должен быть указан в нем, чтобы использовать crontab.

Если файл /var/cron/cron.allow не существует, но имеется файл /var/cron/cron.deny, тогда пользователь не должен быть указан в /var/cron/cron.deny чтобы использовать crontab. Если оба этих файла отсутствуют, только администратору разрешается использовать crontab.
Если файлы /var/cron/cron.allow и /var/cron/cron.deny существуют, они должны быть доступны группе crontab для чтения.

Синтаксис команды:
crontab [-u пользователь ] [-l | -r | -e ] 

Доступны следующие опции:

-u пользователь - указывает пользователя, чей crontab должен быть отредактирован. Если эта опция не указана, использует crontab пользователя, выполняющего команду. При работе с собственным файлом crontab опцию –u можно не указывать.

– l – отображает текущий файл crontab; 

– r – удаляет текущий файл crontab;

– e – изменяет файл crontab редактором. 

Еще до того как файл crontab будет помещен в очередь заданий программы cron, необходимо установить переменную окружения EDITOR. Чтобы установить vi в качестве редактора, откройте файл .profile, находящейся в домашнем каталоге и поместите в него команды EDITOR=vi; export EDITOR
Далее создайте файл <имя_пользователя>cron (например, ivancron), где <имя_пользователя> - ваше регистрационное имя, в котором укажите команды для cron.

Чтобы поместить в очередь планировщика заданий свой файл crontab, выполните команду crontab <имя_пользователя>cron, например: crontab ivancron

Копия файла будет помещена в каталог /var/spool/cron, а имя копии будет совпадать с регистрационным именем (например, ivan). 
Для вывода на экран содержимого cron-файла используется команда crontab –l.

Чтобы отредактировать cron-файл используется команда crontab –l. Для редактирования будет использоваться редактор, указанный в переменной окружения EDITOR. 

Для удаления своего cron-файла используется команда crontab –r. Если cron-файл удален случайно, то инсталлируйте заново исходный файл с помощью команды crontab <имя_пользователя>cron.

Используемые файлы: 

/var/cron/cron.allow - список пользователей, которым разрешено использовать crontab;

/var/cron/cron.deny - список пользователей, которым запрещено использовать crontab;

/var/cron/tabs - каталог с индивидуальными crontab файлами. 

## 5. Что такое сигналы?

Сигналы – это короткие стандартные сообщения, которыми могут обмениваться процессы с помощью системы. Сообщение-сигнал не содержит никакой информации, кроме номера сигнала (для удобства вместо номера можно использовать предопределенное системой имя). Если процессу необходимо реагировать на сигнал особенным образом, он может зарегистрировать обработчик, а если обработчика нет, за него отреагирует система. Как правило, это приводит к немедленному завершению процесса, получившего сигнал. Обработчик сигнала запускается асинхронно, немедленно после получения сигнала, что бы процесс в это время не делал. Вызов подпрограммы обработки называется перехватом сигнала.

## 6. Как с помощью команды kill посылать сигналы процессам? 

kill - завершить процессы или послать им сигнал. 

Утилита kill посылает сигнал процессу или процессам, заданным операндами pid. (Опера́нд в языках программирования ― аргумент операции; данные, которые обрабатываются командой; грамматическая конструкция, обозначающая выражение, задающее значение аргумента операции. Иногда операндом называют место, позицию в тексте, где должен стоять аргумент операции.)

Процесс, которому посылается сигнал, должен принадлежать текущему пользователю, но суперпользователь (root) может посылать сигналы любым процессам.

/usr/bin/kill -s сигнал pid...

Поддерживаются следующие опции: 

-l - выдать все значения сигналов, поддерживаемые в данной реализации, если операнды не указаны.

-s сигнал – задает сигнал, который надо послать, используя одно из символьных имен.

Номера (идентификаторы) процессов можно найти с помощью команды ps.

## 7. Для чего предназначены команды nice и renice?

nice - запускает программу с заданием приоритета.

Приоритет процесса определяется так называемым «значением nice», которое лежит в пределах от +20 (наименьший приоритет, процесс выполняется только тогда, когда ничто другое не занимает процессор), до -20 (наивысший приоритет).

Значение nice устанавливается для каждого процесса в момент порождения этого процесса и при обычном запуске команд или программ принимается равным приоритету родительского процесса. Но существует специальная команда nice, которая позволяет изменять значение nice при запуске программы. Формат использования: nice [- adnice] command [args] 

где adnice – значение (от –20 до +19), добавляемое к значению nice процесса-родителя. Полученная сумма и будет значением nice для запускаемого процесса. Отрицательные adnice значения может устанавливать только суперпользователь. Если опция – adnice не задана, то по умолчанию для процесса-потомка устанавливается значение nice, увеличенное на 10 по сравнению со значением nice родительского процесса.

Пример использования: nice yes > /dev/null &

Чтобы запустить процесс со значением nice, отличным от 10, можно использовать ключ -n.
nice -n 15 yes > /dev/null &
или
nice -15 yes > /dev/null &

Чтобы установить значение nice ниже нуля, требуются права суперпользователя. В противном случае будет установлено значение 0. 
Поэтому, чтобы задать значение nice меньше 0, необходимо запускать программу как root, или использовать sudo.

Команда renice служит для изменения значения nice для уже выполняющихся процессов.

Формат команды: renice priority [[-p] PID] [[-g] grp] [[-u] user]

Например, команда renice -1 987 –u daemon –p 32 увеличивает на 1 приоритет процессов с PID 987 и 32, а также всех процессов пользователя daemon.

Также, команда renice позволяет суперпользователю изменять значение nice процессов любого пользователя. Это делается с помощью ключа -u. 
Следующая команда изменяет значение приоритета всех процессов пользователя на -19: # renice -n -19 -u lubos

## 8. Как использовать команду ps?  

Команда предназначена для получения информации о существующих в операционной системе процессах.

GNU-версия этой программы, входящая в состав Linux, поддерживает опции в стиле трех разных типов UNIX. 
Опции в стиле Unix98 состоят из одного или нескольких символов, перед которыми должен стоять дефис. 
Опции в стиле BSD имеют аналогичный вид, только используются без дефиса.
Опции, характерные только для GNU-версии представляют собой слово, перед которым должно стоять два дефиса. 
Их нельзя объединять, как однобуквенные опции двух предшествующих типов.

Таким образом, существует три равноправных формата задания этой команды:

ps [-опции]
ps [опции]
ps [-- длинное_имя_опции [-- длинное_имя_опции] ...]

## 9. Для чего предназначена команда top и как ее использовать?

top отображает состояние процессов и их активность в реальном времени. 

Если команда ps позволяет сделать моментальный снимок процессов, запущенных в системе. В отличие от ps команда top отображает состояние процессов и их активность в реальном времени. 

В верхней части вывода отображается астрономическое время, время, прошедшее с момента запуска системы, число пользователей в системе, число запущенных процессов и число процессов, находящихся в разных состояниях, данные об использовании ЦПУ (ЦП; также центра́льное проце́ссорное устро́йство — ЦПУ), памяти и свопа.

Далее отображается таблица, описывающая отдельные процессы.

Графы таблицы аналогичны поля вывода команды ps. Содержимое окна обновляется каждые 5 секунд. Список процессов может быть отсортирован по используемому времени ЦПУ (по умолчанию), по использованию памяти, по PID, по времени исполнения. Переключать режимы отображения можно с помощью команд, которые программа top воспринимает. Это следующие команды:

<Shift'>+<N'> – сортировка по PID (идентификатор процесса (англ. Process ID));

<Shift'>+<A'> – сортировать процессы по возрасту;

<Shift'>+<P'> – сортировать процессы по использованию ЦПУ;

<Shift'>+<M'> – сортировать процессы по использованию памяти;

<Shift'>+<T'> – сортировка по времени выполнения. 

Кроме команд, определяющих режим сортировки, команда top воспринимает еще ряд команд, которые позволяют управлять процессами в интерактивном режиме. 
С помощью команды <K> можно завершить некоторый процесс (его PID будет запрошен), а с помощью команды <R> можно переопределить значение nice для некоторого процесса.
Таким образом, эти две команды аналогичны командам kill и renice.

## 10. Как использовать команду w?

w - выводит информацию о работающих в данный момент на машине пользователях и об их процессах.

Заголовок показывает в следующем порядке: текущее время, сколько времени работает система, сколько пользователей в данный момент работают и среднее время загрузки системы за последние 1, 5 и 15 минут.

Для каждого пользователя выводятся следующие записи: регистрационное имя, название терминала (tty), удалённая машина, время регистрации в системе, время простоя, JCPU, PCPU и командную строку его текущего процесса. 

Доступные опции: 

– h – не выводить заголовок;

– u – игнорировать имена пользователей при определении времени текущего процесса и cpu;

– s – использовать короткий формат. Не выводит время регистрации, время JCPU и PCPU;

– f – включить или выключить вывод поля from (имя удалённой машины);

– V – мывести информацию о версии;

user – показать информацию только об указанном пользователе.

Используемые файлы: 

/var/run/utmp информация о пользователях, зарегистрированных в данный момент;

/proc - информация о процессах. 
